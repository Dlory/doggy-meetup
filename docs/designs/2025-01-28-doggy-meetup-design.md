# 狗狗拼团 (Doggy Meetup) 设计方案

> 创建时间: 2026-01-28
> 项目类型: 社交拼团 App
> 技术框架: 基于 GuardAngel 框架

---

## 第一部分：项目概述

### 项目名称
**狗狗拼团 (Doggy Meetup)**

### 项目定位
一个连接狗狗主人的社交平台，通过「拼团」形式组织小型狗狗聚会，让毛孩子们找到合适的玩伴。

### 核心价值
- **社交匹配**：通过狗狗MBTI和筛选条件，找到性格相容的玩伴
- **活动组织**：轻量化发起聚会，自动组建临时沟通小组
- **快乐分享**：狗狗广场记录和分享美好瞬间

### 目标用户
- 城市中拥有一只或多只狗狗的宠物主人
- 希望狗狗能社交、但找不到合适玩伴的主人
- 热爱分享宠物生活的社区用户

---

## 第二部分：功能模块设计

### 2.1 狗狗档案

#### 基础信息
| 字段 | 类型 | 说明 |
|------|------|------|
| 狗狗名称 | 文本 | 必填 |
| 品种 | 选择/搜索 | 支持模糊搜索，支持"串串/未知" |
| 体型 | 单选 | 小型/中型/大型/巨型 |
| 性别 | 单选 | 弟弟/妹妹 |
| 年龄 | 数值+单位 | 月/年 |
| 头像 | 图片 | 支持多张照片 |

#### MBTI 性格测试
- **测试形式**：问卷式，主人回答20-30题行为相关问题
- **结果输出**：16型人格之一，带有狗狗化解读
- **维度保留**：E/I、S/N、T/F、J/P 框架保留，解释适配狗狗行为
  - E/I → 社交活力指数（喜欢社交 vs 粘着主人）
  - S/N → 玩法偏好（喜欢实体玩具 vs 喜欢探索/追捕）
  - T/F → 行为风格（冷静理性 vs 热情粘人）
  - J/P → 活动节奏（有规律 vs 随性自由）

#### 管理功能
- 支持添加多只狗狗
- 支持编辑/删除狗狗信息
- 支持重新测试MBTI

---

### 2.2 聚会发起（拼团）

#### 发起流程
```
点击"发起聚会" → 填写聚会信息 → 发布到狗狗广场
```

#### 聚会信息字段
| 字段 | 说明 |
|------|------|
| 聚会主题 | 必填，如"周末踏春""小狗约会"等 |
| 地点 | 从自建地点库选择（支持搜索、按距离排序） |
| 时间 | 日期+具体时间点 |
| 期望人数 | 2-10只狗狗 |
| 参与条件 | 可选：体型范围、品种偏好、年龄段 |
| 备注 | 可选：如"请带好拾便袋""有小型犬游乐区"等 |

#### 参与条件示例
- 体型筛选：仅限小型犬
- 品种筛选：金毛/拉布拉多偏好
- 年龄筛选：1-3岁活泼期

---

### 2.3 狗狗广场

#### 会话列表展示
每条聚会卡片显示：
- 发起人头像+昵称
- 发起人的狗狗头像+MBTI标签
- 聚会主题
- 地点+时间
- 当前人数/目标人数（如 3/5）
- 参与狗狗头像墙
- 状态标签：招募中 / 已满员 / 进行中 / 已结束

#### 列表筛选/排序
- 按距离排序
- 按时间排序
- 筛选：仅看未满员的
- 筛选：符合我家狗狗条件的

#### 快乐瞬间（动态流）
- 发布图文动态
- 点赞、评论
- 话题标签（如 #周末遛狗 #公园约会）

---

### 2.4 临时遛狗小组

#### 组建触发
| 触发方式 | 说明 |
|----------|------|
| 人数满员 | 自动创建临时小组，进入"即将开始"状态 |
| 管理员手动启动 | 人数未满但管理员决定提前开始 |

#### 聚会状态流转
```
招募中 → [人数满员 OR 管理员启动] → 即将开始 → 进行中 → 已结束
                    ↓
              [有人退出且未手动启动] 回到招募中
```

#### 小组功能
- **群聊**：文字消息 + 语音消息
- **位置共享**：一键发送实时位置，方便集合
- **活动通知**：聚会开始前15分钟提醒
- **活动状态**：发起人可标记"已开始"/"已结束"

#### 管理权限
**发起人**作为管理员，拥有：
- 踢出成员
- 修改时间/地点
- 取消聚会
- 标记活动状态
- 提前启动（人数未满时）

#### 退出/补人机制
- 成员退出后，该聚会重新回到"招募中"状态
- 原小组保留，新成员加入后更新群组

#### 管理员提前启动
- 按钮显示："提前开始（当前X人）"
- 点击后确认弹窗："当前只有X人，确定要提前开始吗？"
- 启动后锁定加入，状态变为"进行中"
- 已报名但未在线的成员会收到推送通知

---

## 第三部分：技术架构设计

### 3.1 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                         客户端 (React Native + Expo)         │
├─────────────────────────────────────────────────────────────┤
│  状态管理    │  导航      │  地图        │  实时通信        │
│  Zustand     │  React Nav │  Mapbox      │  WebSocket      │
└─────────────────────────────────────────────────────────────┘
                              ↕ HTTPS/WSS
┌─────────────────────────────────────────────────────────────┐
│                       服务端 (FastAPI)                       │
├─────────────────────────────────────────────────────────────┤
│  API层       │  服务层    │  数据层      │  任务层          │
│  路由/验证    │  业务逻辑   │  PostgreSQL  │  Celery         │
└─────────────────────────────────────────────────────────────┘
                              ↕
┌─────────────────────────────────────────────────────────────┐
│  Redis (缓存/会话)  │  PostgreSQL (主数据)  │  OSS (图片)     │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 技术选型（复用 GuardAngel 框架）

#### 移动端
| 模块 | 技术方案 | 版本 |
|------|----------|------|
| 框架 | Expo + React Native | ~54.0.32 / 0.81.5 |
| 状态管理 | Zustand | ^5.0.10 |
| 地图 | @rnmapbox/maps | ^10.2.10 |
| 导航 | React Navigation | ^7.1.x |
| 网络 | Axios | ^1.13.2 |
| 实时通信 | WebSocket (原生) | - |

#### 后端
| 模块 | 技术方案 | 版本 |
|------|----------|------|
| 框架 | FastAPI | ^0.115.0 |
| 数据库 | PostgreSQL + SQLAlchemy | ^2.0.35 |
| 缓存 | Redis | ^5.2.0 |
| 异步任务 | Celery | ^5.4.0 |
| WebSocket | websockets | ^13.1 |

---

### 3.3 数据模型设计

#### 核心实体关系
```
User (用户)
  │
  ├── 1:N ──> Dog (狗狗)
  │
  ├── 1:N ──> Session (发起的聚会) ←── N:1 ──> Location (地点)
  │                              │
  │                              ├── N:M ──> Dog (参与的狗狗)
  │                              │
  │                              └── 1:1 ──> ChatGroup (临时小组)
  │                                         │
  │                                         └── 1:N ──> ChatMessage (消息)
  │
  └── 1:N ──> Post (动态)
                  │
                  └── 1:N ──> Comment (评论)
```

#### 关键数据表

**User（用户）**
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| nickname | String | 昵称 |
| avatar | String | 头像URL |
| phone | String | 手机号（可选） |
| created_at | DateTime | 注册时间 |

**Dog（狗狗）**
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| user_id | UUID | 外键→User |
| name | String | 狗狗名称 |
| breed | String | 品种 |
| size | Enum | 体型: small/medium/large/giant |
| gender | Enum | 性别 |
| age_months | Int | 年龄（月） |
| mbti | String(4) | MBTI类型如"ESEJ" |
| avatar | String | 头像URL |

**Location（地点）**
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| name | String | 地点名称 |
| address | String | 地址 |
| latitude | Float | 纬度 |
| longitude | Float | 经度 |
| is_dog_friendly | Boolean | 是否适合狗狗 |
| tags | Array | 标签如["有围栏","有水源"] |
| created_by | UUID | 创建者 |

**Session（聚会）**
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| creator_id | UUID | 发起人 |
| location_id | UUID | 地点 |
| title | String | 主题 |
| scheduled_at | DateTime | 计划时间 |
| max_dogs | Int | 期望人数 |
| requirements | JSON | 参与条件筛选 |
| status | Enum | recruiting/full/upcoming/ended/cancelled |
| chat_group_id | UUID | 关联小组 |

**SessionParticipant（参与者）**
| 字段 | 类型 | 说明 |
|------|------|------|
| session_id | UUID | 聚会ID |
| dog_id | UUID | 狗狗ID |
| joined_at | DateTime | 加入时间 |

**ChatGroup（聊天组）**
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| session_id | UUID | 关联聚会 |
| name | String | 组名 |
| created_at | DateTime | 创建时间 |

**Post（动态）**
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| user_id | UUID | 发布者 |
| dog_id | UUID | 关联狗狗 |
| content | String | 文字内容 |
| images | Array | 图片URL数组 |
| tags | Array | 话题标签 |
| created_at | DateTime | 发布时间 |

---

## 第四部分：页面流程设计

### 4.1 主要页面结构

```
App
├── 认证模块
│   ├── 登录/注册页
│   └── 手机号验证
│
├── 主模块 (底部导航)
│   ├── 广场 (首页)
│   │   ├── 广场首页 (聚会列表 + 动态)
│   │   ├── 聚会详情页
│   │   ├── 发起聚会页
│   │   ├── 地点选择页
│   │   └── 动态详情/评论页
│   │
│   ├── 小组
│   │   ├── 我的小组列表
│   │   ├── 小组聊天页
│   │   └── 聚会状态页
│   │
│   ├── 我的
│   │   ├── 个人中心
│   │   ├── 我的狗狗
│   │   ├── 狗狗详情/编辑
│   │   ├── MBTI测试页
│   │   ├── 我的聚会
│   │   └── 设置
│   │
│   └── 消息
│       ├── 系统通知
│       └── 聊会邀请
```

### 4.2 核心用户流程

#### 流程一：首次使用
```
启动App
  → 登录/注册（手机号验证）
  → 创建第一只狗狗档案
  → 进行MBTI测试
  → 进入狗狗广场
```

#### 流程二：发起聚会
```
广场首页
  → 点击"发起聚会"
  → 填写聚会信息
    ├── 选择主题
    ├── 选择地点（搜索/筛选）
    ├── 选择时间
    ├── 设置人数
    └── 设置参与条件（可选）
  → 确认发布
  → 回到广场，看到自己的聚会卡片
```

#### 流程三：参加聚会
```
广场首页
  → 浏览聚会列表
  → 点击感兴趣的聚会卡片
  → 查看详情（已参与的狗狗、发起人信息）
  → 选择参加的狗狗
  → 确认报名
  → 收到报名成功通知
```

#### 流程四：拼团成功→小组活动
```
聚会报名满员 / 管理员提前启动
  → 自动创建临时小组
  → 所有成员收到"拼团成功"通知
  → 进入小组聊天
  → 活动前15分钟收到提醒
  → 活动当天共享位置集合
  → 活动结束后可发布动态
```

### 4.3 页面原型说明

#### 广场首页
```
┌─────────────────────────────────────┐
│  🐕 狗狗拼团        🔔  ⚙️         │
├─────────────────────────────────────┤
│  [聚会] [动态]           [+发起]    │
├─────────────────────────────────────┤
│  ┌───────────────────────────────┐  │
│  │ 📍 朝阳公园                   │  │
│  │    周末踏春聚会               │  │
│  │    🐶🐶🐶 3/5  招募中        │  │
│  │    @金毛主人 · 明天 14:00      │  │
│  └───────────────────────────────┘  │
│  ┌───────────────────────────────┐  │
│  │ 📍 大宁公园                   │  │
│  │    小型犬社交局               │  │
│  │    🐶🐶🐶🐶 4/4  已满员      │  │
│  │    @柯基妈妈 · 周日 10:00      │  │
│  └───────────────────────────────┘  │
├─────────────────────────────────────┤
│  ─── 动态 ───                      │
│  ┌───────────────────────────────┐  │
│  │ 🐕 雨宝今天交到新朋友啦！      │  │
│  │    [图片] [图片]              │  │
│  │    💬 3  ❤️ 12                │  │
│  └───────────────────────────────┘  │
├─────────────────────────────────────┤
│  [广场] [小组] [我的] [消息]        │
└─────────────────────────────────────┘
```

#### 发起聚会页
```
┌─────────────────────────────────────┐
│  ← 发起聚会                         │
├─────────────────────────────────────┤
│  主题                               │
│  [周末踏春________________]         │
│                                     │
│  地点 📍                            │
│  [朝阳公园                  >]      │
│                                     │
│  时间 🕐                            │
│  [明天 14:00               >]       │
│                                     │
│  期望人数 🐶                         │
│  [5] 只                             │
│                                     │
│  参与条件 (可选)                     │
│  ☑ 体型限制 [小型犬           >]    │
│  ☐ 品种偏好                >        │
│  ☐ 年龄范围                >        │
│                                     │
│  备注                               │
│  [请带好拾便袋____________]         │
│                                     │
│  [            发布聚会            ] │
└─────────────────────────────────────┘
```

#### 小组聊天页
```
┌─────────────────────────────────────┐
│  ← 周末踏春小组 (5人)      ⋯        │
├─────────────────────────────────────┤
│  系统: 拼团成功！活动开始前15分钟   │
│  会提醒大家                         │
│                                     │
│  @金毛主人  14:00                   │
│  大家好，明天见！                   │
│                                     │
│  @柯基妈妈  14:05                   │
│  收到，期待！🐶                     │
│                                     │
│  @雪纳瑞爸爸 14:10                  │
│  [📍 共享位置]                      │
│                                     │
│  @金毛主人  14:15                   │
│  [🎤 语音 5"]                       │
│                                     │
│                                     │
│                                     │
├─────────────────────────────────────┤
│  [+] 输入消息...        [📍][🎤][↵] │
└─────────────────────────────────────┘
```

---

## 第五部分：API 设计

### 5.1 API 基础规范

| 项目 | 规范 |
|------|------|
| 基础URL | `/api/v1` |
| 认证方式 | Bearer Token (JWT) |
| 响应格式 | JSON |
| 错误码 | HTTP标准状态码 |

### 5.2 认证模块

```
POST   /auth/register           # 注册
POST   /auth/login              # 登录
POST   /auth/verify-phone       # 验证手机号
POST   /auth/send-code          # 发送验证码
GET    /auth/me                 # 获取当前用户信息
```

### 5.3 狗狗模块

```
GET    /dogs                    # 获取我的狗狗列表
POST   /dogs                    # 创建狗狗档案
GET    /dogs/:id                # 获取狗狗详情
PUT    /dogs/:id                # 更新狗狗信息
DELETE /dogs/:id                # 删除狗狗
POST   /dogs/:id/mbti           # 提交MBTI测试，获取结果
GET    /dogs/:id/mbti           # 获取MBTI测试题目
```

### 5.4 聚会模块

```
GET    /sessions                # 获取聚会列表（支持筛选、排序）
POST   /sessions                # 发起聚会
GET    /sessions/:id            # 获取聚会详情
PUT    /sessions/:id            # 修改聚会（仅发起人）
DELETE /sessions/:id            # 取消聚会（仅发起人）
POST   /sessions/:id/join       # 报名参加
POST   /sessions/:id/leave      # 离开聚会
POST   /sessions/:id/start      # 管理员提前启动
GET    /sessions/:id/participants  # 获取参与列表
```

**查询参数示例:**
```
GET /sessions?status=recruiting&lat=31.2&lng=121.5&radius=5000&dog_size=small
```

### 5.5 地点模块

```
GET    /locations              # 获取地点列表
POST   /locations              # 创建地点（需审核/或直接创建）
GET    /locations/:id          # 获取地点详情
GET    /locations/nearby       # 获取附近地点
GET    /locations/search       # 搜索地点
POST   /locations/:id/favorite # 收藏地点
```

### 5.6 小组/聊天模块

```
GET    /groups                 # 获取我的小组列表
GET    /groups/:id             # 获取小组详情
GET    /groups/:id/messages    # 获取聊天历史
POST   /groups/:id/messages    # 发送消息
POST   /groups/:id/location    # 共享位置
PUT    /groups/:id/:user_id    # 移除成员（仅管理员）
```

### 5.7 动态/广场模块

```
GET    /posts                  # 获取动态列表
POST   /posts                  # 发布动态
GET    /posts/:id              # 获取动态详情
DELETE /posts/:id              # 删除动态
POST   /posts/:id/like         # 点赞
DELETE /posts/:id/like         # 取消点赞
POST   /posts/:id/comments     # 发表评论
GET    /posts/:id/comments     # 获取评论列表
```

### 5.8 WebSocket 事件

**连接:** `wss://api/v1/ws`

**客户端发送:**
```json
{"type": "ping"}
{"type": "join_group", "group_id": "uuid"}
{"type": "send_message", "group_id": "uuid", "content": "大家好"}
{"type": "share_location", "group_id": "uuid", "lat": 31.2, "lng": 121.5}
```

**服务端推送:**
```json
{"type": "new_message", "group_id": "uuid", "message": {...}}
{"type": "session_full", "session_id": "uuid", "group_id": "uuid"}
{"type": "session_started", "session_id": "uuid"}
{"type": "notification", "title": "...", "body": "..."}
```

---

## 第六部分：实施计划 (MVP)

### 6.1 MVP 功能范围

**第一期：核心拼团功能**
- 用户注册/登录
- 狗狗档案（不含MBTI，先做基础信息）
- 发起聚会/参加聚会
- 聚会列表/详情
- 拼团成功通知

**第二期：社交增强**
- 狗狗MBTI测试
- 临时小组聊天
- 位置共享
- 参与条件筛选

**第三期：社区完善**
- 狗狗广场动态
- 点赞评论
- 自建地点库
- 举报/信用机制

### 6.2 技术实施步骤

#### 阶段一：项目初始化 (1-2天)
- [ ] 复用 GuardAngel 框架创建新项目
- [ ] 配置 Mapbox、项目结构
- [ ] 搭建后端基础 API 结构
- [ ] 配置数据库模型

#### 阶段二：认证与狗狗档案 (3-4天)
- [ ] 登录/注册页面
- [ ] 狗狗档案 CRUD
- [ ] 狗狗列表/详情页

#### 阶段三：聚会核心功能 (5-7天)
- [ ] 发起聚会流程
- [ ] 聚会列表/筛选
- [ ] 聚会详情页
- [ ] 报名/取消报名逻辑
- [ ] 满员触发机制

#### 阶段四：小组聊天 (4-5天)
- [ ] WebSocket 连接
- [ ] 小组聊天界面
- [ ] 文字/位置消息
- [ ] 管理员权限

#### 阶段五：MBTI 测试 (2-3天)
- [ ] 问卷设计（20题）
- [ ] 测试页面
- [ ] 结果计算与展示

#### 阶段六：完善与优化 (3-5天)
- [ ] 推送通知
- [ ] 地点管理
- [ ] UI/UX 优化
- [ ] Bug 修复

### 6.3 MBTI 测试题示例（部分）

| 题目 | 选项 | 维度 |
|------|------|------|
| 遇到新狗时，你家狗狗会？ | A. 主动凑上去闻 | B. 躲在你身后 | E/I |
| 玩玩具时，更喜欢？ | A. 扔球你捡回来 | B. 追逐打闹 | S/N |
| 你不在家时，狗狗会？ | A. 安静等待 | B. 吵闹拆家 | T/F |
| 散步路线被打乱，狗狗会？ | A. 焦虑不安 | B. 随遇而安 | J/P |

（完整16型结果需设计20-30题，每个维度至少5题覆盖）

### 6.4 自建地点库初始数据

建议预先录入的地点类型：
- 城市知名公园（有围栏的优先）
- 宠物友好商场
- 大型草坪绿地
- 宠物主题咖啡厅

### 6.5 技术风险与应对

| 风险 | 应对方案 |
|------|----------|
| Mapbox Token 费用 | MVP 阶段使用开发版免费额度，控制日活 |
| WebSocket 并发 | 初期用户量小，先不做优化，后续可升级 |
| 位置服务耗电 | 参考 GuardAngel 的后台定位方案 |
| 内容审核 | MVP 阶段先做基础敏感词过滤，后续接入第三方 |

---

## 设计总结

**项目名称:** 狗狗拼团 (Doggy Meetup)

**核心价值:** 通过轻量化的拼团机制，让狗狗主人找到合适的玩伴，组织线下社交活动。

**技术亮点:**
- 复用已验证的 GuardAngel 技术栈
- Mapbox 地图集成（地点、定位、共享）
- WebSocket 实时通信
- 狗狗 MBTI 性趣匹配

**MVP 交付物:**
- iOS/Android 双端 App
- 后端 API 服务
- 基础管理系统

---

*设计方案生成时间: 2026-01-28*
*基于框架: GuardAngel 技术框架*
